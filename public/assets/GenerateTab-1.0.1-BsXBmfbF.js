import{u as X,r as t,a as M,l as _,j as e}from"./index-1.0.1-2Be6sSou.js";import{v as O,t as Y,g as Z}from"./validation-1.0.1-Dy4TNGJh.js";const ee=({onGenerate:f,loading:r,config:l,isAdmin:m})=>{var q,A,L;const o=X(),[p,w]=t.useState(""),[N,Q]=t.useState(((q=l==null?void 0:l.generation)==null?void 0:q.steps)||30),[S,H]=t.useState(((A=l==null?void 0:l.generation)==null?void 0:A.guidance_scale)||7.5),[y,F]=t.useState(""),[j,B]=t.useState(!0),[h,b]=t.useState({}),[g,P]=t.useState([]),[d,U]=t.useState(""),[v,R]=t.useState(""),[C,I]=t.useState(""),[T,D]=t.useState(""),[G,V]=t.useState(!1),[c,k]=t.useState(!1),[u,E]=t.useState({});t.useEffect(()=>{m&&$()},[m]);const $=async()=>{V(!0);try{const n=(await M.albums.getAll()).filter(a=>a.is_set_template===!0);P(n)}catch(s){_.error("Failed to fetch templates:",s),o.error("Failed to load batch templates")}finally{V(!1)}},z=s=>{s.preventDefault(),b({});const n={prompt:p.trim(),steps:N,guidance_scale:S,seed:!j&&y?parseInt(y):void 0},a=O(Z,n);if(!a.success){b(a.errors),_.warn("Form validation failed:",a.errors);return}const x={prompt:a.data.prompt,steps:a.data.steps,guidance_scale:a.data.guidance_scale};a.data.seed!==void 0&&(x.seed=a.data.seed),f(x),w(""),b({})},J=()=>{const s=Math.floor(Math.random()*2147483647);F(s.toString()),B(!1)},K=async s=>{if(s.preventDefault(),E({}),!d){o.error("Please select a template");return}const n=O(Y,v.trim());if(!n.success){E(n.errors);return}k(!0);try{const a={user_theme:v.trim()};if(C){const i=parseInt(C,10);isNaN(i)||(a.steps=i)}if(T){const i=parseInt(T,10);isNaN(i)||(a.seed=i)}const x=await M.albums.generateBatch(d,a);if(x.success){const i=g.find(W=>W.id===d);o.success(`Batch generation started! ${(i==null?void 0:i.template_item_count)||0} jobs queued.`),R(""),I(""),D("")}else o.error(x.error||"Failed to start batch generation")}catch(a){_.error("Failed to generate batch:",a),o.error("Error starting batch generation")}finally{k(!1)}};return e.jsxs("div",{className:"generate-form",children:[e.jsx("h2",{children:"Generate Single Image"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"prompt",children:"Prompt"}),e.jsx("textarea",{id:"prompt",value:p,onChange:s=>{if(w(s.target.value),h.prompt){const n={...h};delete n.prompt,b(n)}},placeholder:"Describe the image you want to generate...",rows:4,disabled:r,required:!0,className:h.prompt?"error":""}),h.prompt&&e.jsx("span",{className:"error-message",children:h.prompt})]}),e.jsxs("div",{className:"controls-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"steps",children:["Steps: ",N,e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["Number of denoising iterations. More steps = more refined image but slower.",e.jsx("br",{}),"â€¢ 20-25: Fast, decent quality",e.jsx("br",{}),"â€¢ 30-40: Balanced (recommended)",e.jsx("br",{}),"â€¢ 50+: Diminishing returns"]})]})]}),e.jsx("input",{type:"range",id:"steps",min:"10",max:"75",step:"5",value:N,onChange:s=>Q(parseInt(s.target.value)),disabled:r}),e.jsxs("div",{className:"range-labels",children:[e.jsx("span",{children:"10"}),e.jsx("span",{children:"Fast"}),e.jsx("span",{children:"Quality"}),e.jsx("span",{children:"75"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"guidance",children:["Guidance Scale: ",S,e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["How closely the model follows your prompt.",e.jsx("br",{}),"â€¢ 1-5: Creative, loose interpretation",e.jsx("br",{}),"â€¢ 7-10: Balanced",e.jsx("br",{}),"â€¢ 10-15: Strong adherence",e.jsx("br",{}),"â€¢ 15-20: Very strict (may reduce quality)"]})]})]}),e.jsx("input",{type:"range",id:"guidance",min:"1",max:"20",step:"0.5",value:S,onChange:s=>H(parseFloat(s.target.value)),disabled:r}),e.jsxs("div",{className:"range-labels",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"Creative"}),e.jsx("span",{children:"Strict"}),e.jsx("span",{children:"20"})]})]})]}),e.jsxs("div",{className:"form-group seed-group",children:[e.jsxs("label",{htmlFor:"seed",children:["Seed (Optional)",e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["Random seed for reproducibility. Same seed + prompt = same image.",e.jsx("br",{}),'â€¢ Leave as "Random" for different results each time',e.jsx("br",{}),"â€¢ Set a specific number to reproduce an image",e.jsx("br",{}),"â€¢ Range: 0 to 2,147,483,647"]})]})]}),e.jsxs("div",{className:"seed-controls",children:[e.jsxs("div",{className:"seed-toggle",children:[e.jsxs("label",{className:"toggle-option",children:[e.jsx("input",{type:"radio",name:"seed-mode",checked:j,onChange:()=>{B(!0),F("")},disabled:r}),e.jsx("span",{children:"Random"})]}),e.jsxs("label",{className:"toggle-option",children:[e.jsx("input",{type:"radio",name:"seed-mode",checked:!j,onChange:()=>B(!1),disabled:r}),e.jsx("span",{children:"Fixed"})]})]}),e.jsx("input",{type:"number",id:"seed",value:y,onChange:s=>F(s.target.value),placeholder:"Enter seed or generate random",min:"0",max:"2147483647",disabled:r||j,className:"seed-input"}),e.jsx("button",{type:"button",onClick:J,disabled:r,className:"generate-seed-btn",title:"Generate random seed","aria-label":"Generate random seed",children:"ðŸŽ²"})]})]}),e.jsx("button",{type:"submit",disabled:r||!p.trim(),children:r?"Generating...":"Generate Image"}),r&&e.jsxs("div",{className:"loading-indicator",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Generating your image... This may take 10-30 seconds"})]})]}),e.jsx("div",{className:"form-divider"}),m?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Generate Batch from Template"}),e.jsxs("form",{onSubmit:K,className:"batch-generate-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"template",children:"Select Template"}),e.jsxs("select",{id:"template",value:d,onChange:s=>U(s.target.value),disabled:G||c,required:!0,children:[e.jsx("option",{value:"",children:"-- Choose a template --"}),g.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.template_item_count||0," items)"]},s.id))]}),G&&e.jsx("span",{className:"loading-text",children:"Loading templates..."}),g.length===0&&!G&&e.jsx("span",{className:"info-text",children:"No templates available. Create one in the Albums tab."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"batch-theme",children:"Art Style Theme"}),e.jsx("input",{id:"batch-theme",type:"text",value:v,onChange:s=>{if(R(s.target.value),u.theme){const n={...u};delete n.theme,E(n)}},placeholder:"e.g., gothic style with ravens and purple tones",disabled:c,required:!0,className:u.theme?"error":""}),u.theme&&e.jsx("span",{className:"error-message",children:u.theme}),d&&e.jsxs("span",{className:"info-text",children:["Example: ",((L=g.find(s=>s.id===d))==null?void 0:L.example_theme)||"Choose a template to see example"]})]}),e.jsxs("div",{className:"controls-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"batch-steps",children:"Steps (Optional)"}),e.jsx("input",{type:"number",id:"batch-steps",value:C,onChange:s=>I(s.target.value),placeholder:"Leave empty for template default",min:"1",max:"150",disabled:c})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"batch-seed",children:"Seed (Optional)"}),e.jsx("input",{type:"number",id:"batch-seed",value:T,onChange:s=>D(s.target.value),placeholder:"Random seed for reproducibility",min:"0",max:"2147483647",disabled:c})]})]}),e.jsx("button",{type:"submit",disabled:c||!d||!v.trim(),children:c?"Starting Batch...":"Generate Batch"}),c&&e.jsxs("div",{className:"loading-indicator",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Queuing batch generation jobs..."})]})]})]}):e.jsxs("div",{className:"info-box",children:[e.jsx("h3",{children:"ðŸŽ¨ Batch Generation from Templates"}),e.jsxs("p",{children:["Admin users can generate complete sets of themed images from templates. Batch generation is available in the ",e.jsx("strong",{children:"Albums"})," tab."]})]})]})},te=({config:f,loading:r,queuePosition:l,onGenerate:m,onGenerateBatch:o,isAdmin:p})=>e.jsxs("div",{className:"generate-tab",children:[r&&e.jsxs("div",{className:"loading-indicator",role:"status","aria-live":"polite","aria-atomic":"true",children:[e.jsx("div",{className:"spinner"}),e.jsxs("p",{children:["Generating image...",l!==null&&l>0&&e.jsxs("span",{children:[" (Queue position: ",l,")"]})]})]}),!r&&e.jsx(ee,{onGenerate:m,onGenerateBatch:o,loading:r,config:f,isAdmin:p})]});export{te as default};
