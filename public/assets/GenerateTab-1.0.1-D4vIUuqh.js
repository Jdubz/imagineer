import{u as ae,r as n,j as e,l,a as j,A as re}from"./index-1.0.1-Bc4FHz3R.js";import{u as I}from"./useAbortableEffect-1.0.1-DbR3AQAQ.js";import{v as M,g as oe,b as ne}from"./validation-1.0.1-CJscdRzZ.js";const ie=({onGenerate:N,onGenerateBatch:f,loading:r,config:m,isAdmin:d})=>{var D,W;const x=ae(),[S,_]=n.useState(""),[b,B]=n.useState(((D=m==null?void 0:m.generation)==null?void 0:D.steps)||30),[g,Q]=n.useState(((W=m==null?void 0:m.generation)==null?void 0:W.guidance_scale)||7.5),[y,w]=n.useState(""),[v,L]=n.useState(!0),[U,V]=n.useState([]),[o,$]=n.useState(""),[A,R]=n.useState(""),[h,G]=n.useState(null),[c,F]=n.useState([]),[k,H]=n.useState([]),[E,O]=n.useState(!1),[i,u]=n.useState({});I(s=>{P(s),z(s)},[]);const P=async s=>{try{const a=await j.sets.getAll(s);V(a)}catch(a){if(a instanceof Error&&a.name==="AbortError")return;l.error("Failed to fetch sets:",a)}},z=async s=>{try{const a=await j.loras.getAll(s);H(a)}catch(a){if(a instanceof Error&&a.name==="AbortError")return;l.error("Failed to fetch LoRAs:",a)}},J=async s=>{try{const a=await j.themes.getRandom(s);R(a)}catch(a){if(a instanceof Error&&a.name==="AbortError")return;l.error("Failed to fetch random theme:",a)}};I(s=>{o?(K(o,s),T(o,s)):(G(null),F([]))},[o]);const K=async(s,a)=>{try{const t=await j.sets.getInfo(s,a);G(t)}catch(t){if(t instanceof Error&&t.name==="AbortError")return;l.error("Failed to fetch set info:",t)}},T=async(s,a)=>{try{const t=await j.sets.getLoras(s,a);F(t)}catch(t){if(t instanceof Error&&t.name==="AbortError")return;l.error("Failed to fetch set LoRAs:",t)}},C=async(s,a)=>{try{const t=await j.sets.updateLoras(s,a);t.success?(x.success("LoRA configuration updated successfully"),T(s)):(l.error("Failed to update LoRAs:",t.error),x.error(`Error: ${t.error||"Failed to update LoRA configuration"}`))}catch(t){if(t instanceof re&&(t.status===401||t.status===403)){x.error("Admin authentication required to update LoRA configuration. Please log in as admin."),l.warn("LoRA update requires admin authentication");return}l.error("Failed to update set LoRAs:",t),x.error("Failed to update LoRA configuration")}},X=s=>{if(!o||!s)return;if(c.some(t=>t.folder===s)){x.warning("This LoRA is already in the set");return}const a=[...c,{folder:s,weight:.5}];C(o,a)},Y=s=>{if(!o)return;const a=c.filter(t=>t.folder!==s);C(o,a)},Z=(s,a)=>{if(!o)return;const t=c.map(p=>p.folder===s?{...p,weight:parseFloat(a)}:p);F(t)},q=()=>{o&&C(o,c)},ee=s=>{s.preventDefault(),u({});const a={prompt:S.trim(),steps:b,guidance_scale:g,seed:!v&&y?parseInt(y):void 0},t=M(oe,a);if(!t.success){u(t.errors),l.warn("Form validation failed:",t.errors);return}const p={prompt:t.data.prompt,steps:t.data.steps,guidance_scale:t.data.guidance_scale};t.data.seed!==void 0&&(p.seed=t.data.seed),N(p),_(""),u({})},se=()=>{const s=Math.floor(Math.random()*2147483647);w(s.toString()),L(!1)},te=s=>{s.preventDefault(),u({});const a={set_name:o,user_theme:A.trim(),steps:b,guidance_scale:g},t=M(ne,a);if(!t.success){u(t.errors),l.warn("Batch form validation failed:",t.errors);return}const p={set_name:t.data.set_name,user_theme:t.data.user_theme,steps:t.data.steps,guidance_scale:t.data.guidance_scale};f(p),R(""),u({})};return e.jsxs("div",{className:"generate-form",children:[e.jsx("h2",{children:"Generate Image"}),e.jsxs("form",{onSubmit:ee,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"prompt",children:"Prompt"}),e.jsx("textarea",{id:"prompt",value:S,onChange:s=>{if(_(s.target.value),i.prompt){const a={...i};delete a.prompt,u(a)}},placeholder:"Describe the image you want to generate...",rows:4,disabled:r,required:!0,className:i.prompt?"error":""}),i.prompt&&e.jsx("span",{className:"error-message",children:i.prompt})]}),e.jsxs("div",{className:"controls-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"steps",children:["Steps: ",b,e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["Number of denoising iterations. More steps = more refined image but slower.",e.jsx("br",{}),"â€¢ 20-25: Fast, decent quality",e.jsx("br",{}),"â€¢ 30-40: Balanced (recommended)",e.jsx("br",{}),"â€¢ 50+: Diminishing returns"]})]})]}),e.jsx("input",{type:"range",id:"steps",min:"10",max:"75",step:"5",value:b,onChange:s=>B(parseInt(s.target.value)),disabled:r}),e.jsxs("div",{className:"range-labels",children:[e.jsx("span",{children:"10"}),e.jsx("span",{children:"Fast"}),e.jsx("span",{children:"Quality"}),e.jsx("span",{children:"75"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"guidance",children:["Guidance Scale: ",g,e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["How closely the model follows your prompt.",e.jsx("br",{}),"â€¢ 1-5: Creative, loose interpretation",e.jsx("br",{}),"â€¢ 7-10: Balanced",e.jsx("br",{}),"â€¢ 10-15: Strong adherence",e.jsx("br",{}),"â€¢ 15-20: Very strict (may reduce quality)"]})]})]}),e.jsx("input",{type:"range",id:"guidance",min:"1",max:"20",step:"0.5",value:g,onChange:s=>Q(parseFloat(s.target.value)),disabled:r}),e.jsxs("div",{className:"range-labels",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"Creative"}),e.jsx("span",{children:"Strict"}),e.jsx("span",{children:"20"})]})]})]}),e.jsxs("div",{className:"form-group seed-group",children:[e.jsxs("label",{htmlFor:"seed",children:["Seed (Optional)",e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["Random seed for reproducibility. Same seed + prompt = same image.",e.jsx("br",{}),'â€¢ Leave as "Random" for different results each time',e.jsx("br",{}),"â€¢ Set a specific number to reproduce an image",e.jsx("br",{}),"â€¢ Range: 0 to 2,147,483,647"]})]})]}),e.jsxs("div",{className:"seed-controls",children:[e.jsxs("div",{className:"seed-toggle",children:[e.jsxs("label",{className:"toggle-option",children:[e.jsx("input",{type:"radio",name:"seed-mode",checked:v,onChange:()=>{L(!0),w("")},disabled:r}),e.jsx("span",{children:"Random"})]}),e.jsxs("label",{className:"toggle-option",children:[e.jsx("input",{type:"radio",name:"seed-mode",checked:!v,onChange:()=>L(!1),disabled:r}),e.jsx("span",{children:"Fixed"})]})]}),e.jsx("input",{type:"number",id:"seed",value:y,onChange:s=>w(s.target.value),placeholder:"Enter seed or generate random",min:"0",max:"2147483647",disabled:r||v,className:"seed-input"}),e.jsx("button",{type:"button",onClick:se,disabled:r,className:"generate-seed-btn",title:"Generate random seed","aria-label":"Generate random seed",children:"ðŸŽ²"})]})]}),e.jsx("button",{type:"submit",disabled:r||!S.trim(),children:r?"Generating...":"Generate Image"}),r&&e.jsxs("div",{className:"loading-indicator",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Generating your image... This may take 10-30 seconds"})]})]}),e.jsx("div",{className:"form-divider"}),e.jsx("h2",{children:"Generate Set"}),e.jsxs("form",{onSubmit:te,className:"batch-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"set-select",children:["Select Set",e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["Choose a predefined set (e.g., card deck, tarot deck) to generate multiple images.",e.jsx("br",{}),"Each item in the set will be styled with your art theme."]})]})]}),e.jsxs("select",{id:"set-select",value:o,onChange:s=>$(s.target.value),disabled:r,required:!0,children:[e.jsx("option",{value:"",children:"-- Select a set --"}),U.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),h&&e.jsxs("p",{className:"set-info",children:[h.name," (",h.item_count," items)"]})]}),o&&e.jsxs("div",{className:"form-group lora-config-section",children:[e.jsxs("div",{className:"lora-header",children:[e.jsxs("label",{children:["LoRA Configuration",e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["Configure which LoRAs to apply to this set and their influence weights.",e.jsx("br",{}),"â€¢ Weight 0.0 = No effect",e.jsx("br",{}),"â€¢ Weight 0.5 = Moderate effect (recommended)",e.jsx("br",{}),"â€¢ Weight 1.0 = Strong effect",e.jsx("br",{}),"â€¢ Weight 1.5+ = Very strong (may distort)"]})]})]}),e.jsxs("button",{type:"button",onClick:()=>O(!E),className:"toggle-lora-btn",children:[E?"â–¼ Hide":"â–¶ Show"," LoRAs (",c.length,")"]})]}),E&&e.jsxs(e.Fragment,{children:[c.length===0?e.jsx("p",{className:"no-loras-message",children:"No LoRAs configured for this set. Add one below."}):e.jsx("div",{className:"lora-list",children:c.map(s=>{const a=k.find(t=>t.folder===s.folder);return e.jsxs("div",{className:"lora-item",children:[e.jsx("div",{className:"lora-info",children:e.jsx("span",{className:"lora-name",children:(a==null?void 0:a.filename)||s.folder})}),e.jsxs("div",{className:"lora-controls",children:[e.jsxs("label",{htmlFor:`weight-${s.folder}`,className:"weight-label",children:["Weight: ",s.weight.toFixed(2)]}),e.jsx("input",{type:"range",id:`weight-${s.folder}`,min:"0",max:"2",step:"0.05",value:s.weight,onChange:t=>Z(s.folder,t.target.value),onMouseUp:q,onTouchEnd:q,className:"weight-slider",disabled:r||!d,title:d?"":"Admin access required to modify LoRA weights"}),e.jsx("button",{type:"button",onClick:()=>Y(s.folder),className:"remove-lora-btn",disabled:r||!d,title:d?"Remove LoRA":"Admin access required to remove LoRAs",children:"âœ•"})]})]},s.folder)})}),e.jsxs("div",{className:"add-lora-section",children:[e.jsx("label",{htmlFor:"add-lora-select",children:"Add LoRA:"}),e.jsxs("select",{id:"add-lora-select",onChange:s=>{s.target.value&&(X(s.target.value),s.target.value="")},disabled:r||!d,className:"add-lora-select",title:d?"":"Admin access required to add LoRAs",children:[e.jsx("option",{value:"",children:d?"-- Select LoRA to Add --":"-- Admin Access Required --"}),k.filter(s=>!c.some(a=>a.folder===s.folder)).map(s=>e.jsx("option",{value:s.folder,children:s.filename||s.folder},s.folder))]})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"user-theme",children:["Art Style Theme",e.jsxs("span",{className:"tooltip",children:["?",e.jsxs("span",{className:"tooltip-text",children:["Describe the artistic style and atmosphere for your card set.",e.jsx("br",{}),e.jsx("br",{}),"Examples:",e.jsx("br",{}),'â€¢ "watercolor pastels with soft dreamy lighting"',e.jsx("br",{}),'â€¢ "cyberpunk neon with dark urban background"',e.jsx("br",{}),'â€¢ "vintage botanical illustrations"',(h==null?void 0:h.style_suffix)&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),"Style suffix for ",h.name,":",e.jsx("br",{}),'"',h.style_suffix,'"']})]})]})]}),e.jsxs("div",{className:"theme-input-group",children:[e.jsx("textarea",{id:"user-theme",value:A,onChange:s=>{if(R(s.target.value),i.user_theme){const a={...i};delete a.user_theme,u(a)}},placeholder:"e.g., watercolor mystical forest, ethereal glowing light...",rows:3,disabled:r,required:!0,className:i.user_theme?"error":""}),e.jsx("button",{type:"button",onClick:()=>void J(),disabled:r,className:"random-theme-btn",title:"Generate random theme","aria-label":"Generate random theme",children:"ðŸŽ² Random Theme"})]}),i.user_theme&&e.jsx("span",{className:"error-message",children:i.user_theme})]}),e.jsx("button",{type:"submit",disabled:r||!o||!A.trim(),className:"batch-submit-btn",children:r?"Generating Set...":"Generate Complete Set"}),r&&e.jsxs("div",{className:"loading-indicator",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Queuing batch generation... This will create multiple jobs"})]})]})]})},me=({config:N,loading:f,queuePosition:r,onGenerate:m,onGenerateBatch:d,isAdmin:x})=>e.jsxs("div",{className:"generate-tab",children:[f&&e.jsxs("div",{className:"loading-indicator",role:"status","aria-live":"polite","aria-atomic":"true",children:[e.jsx("div",{className:"spinner"}),e.jsxs("p",{children:["Generating image...",r!==null&&r>0&&e.jsxs("span",{children:[" (Queue position: ",r,")"]})]})]}),!f&&e.jsx(ie,{onGenerate:m,onGenerateBatch:d,loading:f,config:N,isAdmin:x})]});export{me as default};
