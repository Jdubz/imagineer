import{u as g,r as n,a as b,A as f,l as u,j as e}from"./index-1.0.1-Bc4FHz3R.js";import{u as v}from"./usePolling-1.0.1-DLeCTzVN.js";const A=()=>{const c=g(),[t,h]=n.useState(null),[d,j]=n.useState(!0),[m,o]=n.useState(!1),r=n.useCallback(async()=>{try{const s=await b.jobs.getAll();h(s),o(!1)}catch(s){if(s instanceof f&&(s.status===401||s.status===403)){o(!0),u.warn("Queue access requires admin authentication");return}u.error("Failed to fetch queue data:",s),c.error("Failed to load job queue")}},[c]);n.useEffect(()=>{r()},[r]),v(r,{interval:2e3,enabled:d,pauseWhenHidden:!0});const i=s=>s?new Date(s).toLocaleString():"-",x=(s,a)=>{if(!s||!a)return"-";const p=new Date(s),N=new Date(a);return`${Math.floor((N.getTime()-p.getTime())/1e3)}s`},l=s=>{const a=`status-badge status-${s}`;return e.jsx("span",{className:a,children:s})};return m?e.jsx("div",{className:"queue-tab",children:e.jsxs("div",{className:"auth-error-banner",children:[e.jsx("h3",{children:"ðŸ”’ Admin Authentication Required"}),e.jsx("p",{children:"The job queue requires admin privileges to view. Please sign in with an admin account."}),e.jsx("button",{onClick:r,className:"retry-button",children:"ðŸ”„ Retry"})]})}):t?e.jsxs("div",{className:"queue-tab",children:[e.jsxs("div",{className:"queue-header",children:[e.jsx("h2",{children:"Job Queue"}),e.jsxs("div",{className:"queue-controls",children:[e.jsxs("label",{className:"auto-refresh-toggle",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:s=>j(s.target.checked)}),"Auto-refresh"]}),e.jsx("button",{onClick:r,className:"refresh-button",children:"ðŸ”„ Refresh"})]})]}),e.jsxs("section",{className:"queue-section",children:[e.jsx("h3",{children:"Currently Running"}),t.current?e.jsxs("div",{className:"job-card current-job",children:[e.jsxs("div",{className:"job-header",children:[e.jsxs("span",{className:"job-id",children:["Job #",t.current.id]}),l("running")]}),e.jsxs("div",{className:"job-details",children:[e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"Prompt:"}),e.jsx("span",{children:t.current.prompt})]}),t.current.lora_paths&&t.current.lora_paths.length>0&&e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"LoRAs:"}),e.jsxs("span",{children:[t.current.lora_paths.length," loaded"]})]}),e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"Started:"}),e.jsx("span",{children:i(t.current.started_at)})]}),e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"Settings:"}),e.jsxs("span",{children:[t.current.width,"Ã—",t.current.height,", ",t.current.steps," steps"]})]})]})]}):e.jsx("div",{className:"empty-state",children:"No job currently running"})]}),e.jsxs("section",{className:"queue-section",children:[e.jsxs("h3",{children:["Queued Jobs",t.queue&&t.queue.length>0&&e.jsx("span",{className:"count-badge",children:t.queue.length})]}),t.queue&&t.queue.length>0?e.jsx("div",{className:"job-list",children:t.queue.map((s,a)=>e.jsxs("div",{className:"job-card queued-job",children:[e.jsxs("div",{className:"job-header",children:[e.jsxs("span",{className:"job-id",children:["#",a+1," - Job #",s.id]}),l("queued")]}),e.jsxs("div",{className:"job-details",children:[e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"Prompt:"}),e.jsx("span",{children:s.prompt})]}),s.lora_paths&&s.lora_paths.length>0&&e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"LoRAs:"}),e.jsxs("span",{children:[s.lora_paths.length," loaded"]})]}),e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"Submitted:"}),e.jsx("span",{children:i(s.submitted_at)})]})]})]},s.id))}):e.jsx("div",{className:"empty-state",children:"No jobs in queue"})]}),e.jsxs("section",{className:"queue-section",children:[e.jsxs("h3",{children:["Recent History",t.history&&t.history.length>0&&e.jsx("span",{className:"count-badge",children:t.history.length})]}),t.history&&t.history.length>0?e.jsx("div",{className:"job-list history-list",children:t.history.slice(0,10).map(s=>{var a;return e.jsxs("div",{className:`job-card history-job status-${s.status}`,children:[e.jsxs("div",{className:"job-header",children:[e.jsxs("span",{className:"job-id",children:["Job #",s.id]}),l(s.status),e.jsx("span",{className:"job-duration",children:x(s.started_at,s.completed_at)})]}),e.jsxs("div",{className:"job-details",children:[e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"Prompt:"}),e.jsx("span",{children:s.prompt})]}),s.status==="completed"&&(s.output_filename||s.output_path)&&e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"Output:"}),e.jsx("span",{className:"output-path",children:s.output_filename||((a=s.output_path)==null?void 0:a.split("/").pop())||"completed"})]}),s.error&&e.jsxs("div",{className:"job-field error",children:[e.jsx("strong",{children:"Error:"}),e.jsx("span",{children:s.error})]}),e.jsxs("div",{className:"job-field",children:[e.jsx("strong",{children:"Completed:"}),e.jsx("span",{children:i(s.completed_at)})]})]})]},`${s.id}-${s.completed_at}`)})}):e.jsx("div",{className:"empty-state",children:"No completed jobs yet"})]})]}):e.jsx("div",{className:"queue-tab loading",children:"Loading queue data..."})};export{A as default};
